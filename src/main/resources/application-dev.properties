# =======================================================
# CONFIGURAÇÃO: DEV (Desenvolvimento Local)
# =======================================================

# Configurações do Banco de Dados DEV
spring.datasource.url=jdbc:postgresql://localhost:5432/dev
spring.datasource.username=postgres
spring.datasource.password=postgres

# Configuração DDL/Hibernate
# 'none': Impede que o Hibernate faça QUALQUER alteração no schema.
# No ambiente DEV, isso força o Flyway a assumir a criação e atualização do esquema
# usando os scripts SQL (V1, V2, etc.) em src/main/resources/db/migration.
spring.jpa.hibernate.ddl-auto=none

# =======================================================
# CONFIGURAÇÃO FLYWAY EXPLÍCITA
# Garante que o Flyway lide com todos os schemas do projeto.
# =======================================================
# Lista todos os schemas que o Flyway deve gerenciar.
spring.flyway.schemas=public,core,colaboradores,clientes,logistica,inventario,social,marketplace

# Permite ao Flyway criar a tabela de histórico de migração 
# mesmo se a base de dados (ou esquemas) não estiver vazia.
spring.flyway.baseline-on-migrate=true

# A propriedade clean-disabled=false também deve estar ativa.
spring.flyway.clean-disabled=false


# =======================================================
# CONFIGURAÇÃO DE LOGGING JPA/HIBERNATE (DIAGNÓSTICO CRÍTICO)
# =======================================================

# 1. Mostrar todo o SQL gerado no console (formatado)
spring.jpa.properties.hibernate.show_sql=true
spring.jpa.properties.hibernate.format_sql=true

# 2. Logar o SQL gerado no nível DEBUG
logging.level.org.hibernate.SQL=DEBUG

# 3. Mostrar os parâmetros reais (bind parameters) enviados ao banco
# ESSENCIAL para verificar se algum campo NOT NULL está a ser enviado como NULL
logging.level.org.hibernate.type.descriptor.sql=TRACE

# 4. Logar eventos de transação
# CRÍTICO para ver a mensagem: "Initiating transaction commit" ou "Initiating transaction rollback"
logging.level.org.springframework.transaction=TRACE

# 5. Logar as operações de persistência do Entity Manager
logging.level.jakarta.persistence.event.PostInsert=TRACE
logging.level.org.hibernate.event.internal.AbstractFlushingEventListener=TRACE

# 6. Logging para fluxos de segurança do Spring (CRÍTICO)
logging.level.org.springframework.security=TRACE